name: Deploy to Prod
on:
  push:
    branches:
      - qa

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Databricks CLI config
        run: |
          # Install the Databricks CLI if needed
          pip install databricks-cli

          # Configure the Databricks CLI with your Databricks authentication token
          cat > ~/.databrickscfg << EOF
          [DEFAULT]
          host = ${{ secrets.DATABRICKS_HOST_URL }}
          token = ${{ secrets.DATABRICKS_TOKEN }}
          jobs-api-version = 2.1
          EOF

      - name: Push Changes to Prod Workspace
        run: |
          # Replace with your Databricks commands to push code and run notebooks in the Prod workspace
          databricks workspace import_dir /Repos/meenu.jain@nagarro.com/data-chisel/test_scripts/ /Repos/meenu.jain@nagarro.com/data-chisel/prod_scripts/
          databricks workspace run-now --notebook /Repos/meenu.jain@nagarro.com/data-chisel/prod_scripts/pytest_script
